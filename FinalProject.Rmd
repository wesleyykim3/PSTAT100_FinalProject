---
title: "PSTAT 100 Final Project - Fertility and Infant Mortality 2010 - Present"
author: "Arthur Kim and Wesley Kim"
date: "March 8th, 2025"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(car)
library(stats)
```


# Abstract
This project investigates fertility and infant mortality trends in the United States 

## Question of Interest
Throughout this report, we will be diving into the question: What demographic factors are most predictive of high infant mortality rates within the states?

### Sub-Questions
- Sub-question 1  
- Sub-question 2  

## Variable Descriptions
- Variable 1: Description  
- Variable 2: Description 

## Data Analysis
```{r}
mortality <- read_csv('data/infant_mortality_biannual_data.csv', show_col_types = FALSE)
fertility <- read_csv('data/fertility_data.csv', show_col_types = FALSE)

fertility_agg <- fertility %>%
  group_by(state, year, group = case_when(
    bmcode %in% c(1, 2, 3) ~ "H1",  # First half of the year
    bmcode %in% c(4, 5, 6) ~ "H2"   # Second half of the year
  )) %>% 
   summarise(
    across(starts_with("births_"), sum, na.rm = TRUE), # Summing birth count variables
    across(starts_with("pop_"), mean, na.rm = TRUE), # Averaging population variables
    .groups = "drop"
  ) %>%
  mutate(bacode = ifelse(group == "H1", 1, 2)) %>%  # Assign bacode after aggregation
  select(-group)  # Remove temporary grouping variable

data <- mortality %>%
  inner_join(fertility_agg, by = c("state", "year", "bacode"), 
             suffix = c("_m", "_f"))

# Remove duplicate columns (those ending in "_f")
data <- data %>%
  select(-ends_with("_f"))

# Rename columns by removing "_m" suffix from mortality dataset
colnames(data) <- str_replace_all(colnames(data), "_m$", "")

data
```


```{r}
data <- data %>%
  mutate(
    IMR_nhblack = (deaths_nhblack / births_nhblack) * 1000,
    IMR_nhwhite = (deaths_nhwhite / births_nhwhite) * 1000,
    IMR_hisp = (deaths_hisp / births_hisp) * 1000,
    IMR_otherraceeth = (deaths_otherraceeth / births_otherraceeth) * 1000,
    IMR_total = (deaths_total / births_total) * 1000, 
    FR_nhblack = (births_nhblack / pop_nhblack) * 1000,
    FR_nhwhite = (births_nhwhite / pop_nhwhite) * 1000,
    FR_hisp = (births_hisp / pop_hisp) * 1000,
    FR_otherraceeth = (births_otherraceeth / pop_otherraceeth) * 1000,
    FR_total = (births_total / pop_total) * 1000,
    prop_married = births_married / births_total,
    prop_college = (births_coll + births_somecoll) / births_total,
    prop_medicaid = births_medicaid / births_total,
    pct_births_age1524 = births_age1524 / births_total,
    pct_births_age2534 = births_age2534 / births_total,
    pct_births_age3544 = births_age3544 / births_total
  )

data
```



```{r}
# Pivot IMR data to long format
IMR_long <- data %>%
  pivot_longer(cols = starts_with("IMR_"), 
               names_to = "Ethnicity", 
               values_to = "IMR") %>%
  mutate(Ethnicity = case_when(
    Ethnicity == "IMR_nhblack" ~ "Non-Hispanic Black",
    Ethnicity == "IMR_nhwhite" ~ "Non-Hispanic White",
    Ethnicity == "IMR_hisp" ~ "Hispanic",
    Ethnicity == "IMR_otherraceeth" ~ "Other Races/Ethnicities",
    Ethnicity == "IMR_total" ~ "Total",
    TRUE ~ Ethnicity  # Keeps any unexpected values unchanged
  ))

# Create scatter plot for IMR by Ethnicity
ggplot(IMR_long, aes(x = Ethnicity, y = IMR)) +
  geom_jitter(width = 0.2, alpha = 0.7, color = "blue") +  # Jitter to avoid overlapping points
  labs(title = "Infant Mortality Rates by Ethnicity",
       x = "Ethnicity",
       y = "Infant Mortality Rate (per 1,000 births)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 15, hjust = 1))
```
```{r}
library(patchwork)

p1 <- ggplot(data, aes(x = pct_births_age1524, y = IMR_total)) +
  geom_point(color = "darkgreen", alpha = 0.6) +
  geom_smooth(method = "lm", se = TRUE, color = "red") +
  labs(title = "Age 15-24", x = "Proportion of Births", y = "IMR") +
  theme_minimal()

# Plot for 25-34
p2 <- ggplot(data, aes(x = pct_births_age2534, y = IMR_total)) +
  geom_point(color = "steelblue", alpha = 0.6) +
  geom_smooth(method = "lm", se = TRUE, color = "red") +
  labs(title = "Age 25-34", x = "Proportion of Births", y = "IMR") +
  theme_minimal()

# Plot for 35-44
p3 <- ggplot(data, aes(x = pct_births_age3544, y = IMR_total)) +
  geom_point(color = "purple", alpha = 0.6) +
  geom_smooth(method = "lm", se = TRUE, color = "red") +
  labs(title = "Age 35-44", x = "Proportion of Births", y = "IMR") +
  theme_minimal()

p1 / p2 / p3
```


```{r}
# Scatter plot: Proportion of Married Women vs. Infant Mortality Rate
ggplot(data, aes(x = prop_married, y = IMR_total)) +
  geom_point(alpha = 0.6, color = "darkblue") +
  geom_smooth(method = "lm", se = TRUE, color = "red") +
  labs(title = "Relationship Between Marriage Rate and Infant Mortality Rate",
       x = "Proportion of Married Women",
       y = "Infant Mortality Rate (per 1,000 births)") +
  theme_minimal() +
  theme(text = element_text(size = 14))
```

```{r}
# Scatter plot: Proportion of College-Educated Women vs. Infant Mortality Rate
ggplot(data, aes(x = prop_college, y = IMR_total)) +
  geom_point(alpha = 0.6, color = "darkblue") +
  geom_smooth(method = "lm", se = TRUE, color = "red") +
  labs(title = "Relationship Between College Education and Infant Mortality Rate",
       x = "Proportion of Women with College Education",
       y = "Infant Mortality Rate (per 1,000 births)") +
  theme_minimal() +
  theme(text = element_text(size = 14))
```
```{r}
# Scatterplot of Medicaid coverage vs. Infant Mortality Rate
ggplot(data, aes(x = prop_medicaid, y = IMR_total)) +
  geom_point(alpha = 0.6, color = "darkblue") +
  geom_smooth(method = "lm", se = TRUE, color = "red") +
  labs(
    title = "Relationship Between Medicaid Birth Coverage and Infant Mortality Rate",
    x = "Proportion of Medicaid-Covered Births",
    y = "Infant Mortality Rate (per 1,000 births)"
  ) +
  theme_minimal()
```
```



```{r}
# Compute and print mean IMR for each Ethnicity group
mean_IMR <- IMR_long %>%
  group_by(Ethnicity) %>%
  summarise(Mean_IMR = mean(IMR, na.rm = TRUE))

mean_FR <- FR_long %>%
  group_by(Ethnicity) %>%
  summarise(Mean_FR = mean(FR, na.rm = TRUE))

mean_IMR
mean_FR
```
```{r}
plot(FR_long$FR, IMR_long$IMR)
```


```{r}
plot(mean_FR$Mean_FR[1:4], mean_IMR$Mean_IMR[1:4])
```


